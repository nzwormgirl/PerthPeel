Resample rasters for social analyses
========================================================

This script imports all of Chris Raymond's social values rasters and the species rasters generated by Maxent for use in the Social Values Zonation Analysis.  A dummy raster of approximately the right extent and a resolution of 500m is created as a base to which all rasters are resampled, using the Hunter region as a mask to remove non-terrestrial areas of habitat.  The social rasters are stacked and multipled by the Hunter region raster to generate a mask to be used to resample the species rasters. All resampled social and species rasters are saved to the directory to be used by the Social Values Zonation analyses.


```{r setup_functions}
#load packages and set working directory
rm(list=ls())
start.time <- proc.time()

computer <- "UM"

if(computer == "super") source("~/R code/Rprofile.r")
if(computer == "UM") {
  envi.directory <- "C:/Users/awhitehead/Documents/GIS_data/Perth-Peel/environmental data/"
  output.directory <- "C:/Users/awhitehead/Documents/GIS_data/Perth-Peel"
  }

setwd(output.directory)

packages(raster)
packages(rgdal)

```


```{r convert_rasters}

e <- extent(360485.1318,444785.1318,6354549.9425,6532149.9425)
empty.raster <- raster(e)
res(empty.raster) <- 100
projection(empty.raster) <- "+proj=utm +zone=50 +south +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"

perth <- raster(paste0(envi.directory,"region.mask.asc"))

hunter_new <- aggregate(hunter,fact=5, na.rm=T)
  hunter_new <- resample(hunter_new,empty.raster)

  # environmental
  (envi.files <- dir(envi.directory,pattern=".asc$", recursive=T, full.names=F)) 
  social.rasters <- lapply(paste0(social.directory,"/",social.files),raster)

for(i in seq(social.files)){
  r <- social.rasters[[i]]
  social.rasters[[i]] <- resample(r,empty.raster)
#   plot(social.rasters[[i]] <- mask(r, hunter_new), main=names(social.rasters[[i]]))
}

#species
  (species.files <- dir(species.directory,pattern=".asc$", recursive=T, full.names=F)) 
  species.rasters <- lapply(paste0(species.directory,"/",species.files),raster)

 species.mask <- species.rasters[[1]]
  species.mask <- aggregate(species.mask,fact=5, na.rm=T)
  species.mask <- resample(species.mask,empty.raster)

social.stack <- stack(social.rasters,hunter_new)
  names.social.stack <- names(social.stack)

envi.mask <- mask(calc(social.stack,mean),species.mask)
    envi.mask[!is.na(envi.mask)] <-1

cropped.social.stack <- social.stack*envi.mask
  names(cropped.social.stack) <- names.social.stack
cropped.social.stack <- stack(cropped.social.stack)

for(i in 1:length(names.social.stack)){
    cat("\n", "Writing ",as.character(names.social.stack[i]), "to ", getwd())
    writeRaster(cropped.social.stack[[i]], paste0(names.social.stack[i],".asc"), overwrite=T)
  }


for(i in seq(species.files)){
  r <- species.rasters[[i]]
  r <- aggregate(r,fact=5, na.rm=T)
  r <- resample(r,empty.raster)
  cat("\n", "Writing ",as.character(names(r)), "to ", getwd())
  plot(mask(r, envi.mask ,filename=species.files[i], overwrite=T), main=names(r))
}


cat("\n","This analysis took",round((proc.time()-start.time)[3]/60,0), "minutes to run with",length(social.files)+length(species.files), "rasters.")
```

```{r AlterCostLayer}

development.costs <- raster("output_files/output_optimal_development.rank.asc")
  plot(development.costs <- (development.costs+0.01)*100)

writeRaster(development.costs, "development.costs_100.asc", overwrite=T)

conservation.costs <- raster("output_files/output_optimal_conservation.rank.asc")
  plot(conservation.costs <- (conservation.costs+0.01)*100)

writeRaster(conservation.costs, "conservation.costs_100.asc", overwrite=T)

```

*This file was last updated on 26 March 2013 and last run on `r format(Sys.time(), "%d %B %Y")`.*